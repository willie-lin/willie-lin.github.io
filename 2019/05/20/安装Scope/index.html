<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Willie Lin"><link rel="alternative" href="/atom.xml" title="Willie Lin" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>安装Scope - Willie Lin</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">Willie Lin</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2019-05-20T15:09:17.000Z">2019 - 05 - 20 23:09:17</time><h1 class="post__title"><a href="/2019/05/20/安装Scope/">安装Scope</a></h1><div class="post__main echo"><h3 id="安装Scope"><a href="#安装Scope" class="headerlink" title="安装Scope"></a>安装Scope</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f <span class="string">"https://cloud.weave.works/k8s/scope.yaml?k8s-version=<span class="variable">$(kubectl version | base64 | tr -d '\n')</span>&amp;k8s-service-type=NodePort"</span></span><br></pre></td></tr></table></figure>
<p>安装完成显示如下：</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="keyword">@k8s</span>-master yyhmmwan]# kubectl apply -f <span class="string">"https://cloud.weave.works/k8s/scope.yaml?k8s-version=$(kubectl vers</span></span><br><span class="line"><span class="string">ion | base64 | tr -d '\n')&amp;k8s-service-type=NodePort"</span></span><br><span class="line">namespace/weave created</span><br><span class="line">serviceaccount/weave-<span class="keyword">scope</span> created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/weave-<span class="keyword">scope</span> created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/weave-<span class="keyword">scope</span> created</span><br><span class="line">deployment.apps/weave-<span class="keyword">scope</span>-app created</span><br><span class="line">service/weave-<span class="keyword">scope</span>-app created</span><br><span class="line">deployment.apps/weave-<span class="keyword">scope</span>-cluster-agent created</span><br><span class="line">daemonset.extensions/weave-<span class="keyword">scope</span>-agent created</span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-<span class="keyword">master</span> <span class="title">yyhmmwan</span>]<span class="comment"># kubectl get pod -n weave</span></span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">weave-scope-agent-<span class="number">5</span>g92b                      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">5m</span>50s</span><br><span class="line">weave-scope-agent-z55pn                      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">5m</span>50s</span><br><span class="line">weave-scope-app-<span class="number">6</span>cbf5dbc45-hw7xp             <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">5m</span>49s</span><br><span class="line">weave-scope-cluster-agent-<span class="number">5</span>d7f64677b-<span class="number">6</span>xr2l   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">5m</span>50s</span><br><span class="line">[root@k8s-<span class="keyword">master</span> <span class="title">yyhmmwan</span>]<span class="comment"># kubectl get svc -n weave</span></span><br><span class="line">NAME              <span class="keyword">TYPE</span>       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">weave-scope-app   NodePort   <span class="number">10.103</span>.<span class="number">101.115</span>   <span class="tag">&lt;none&gt;</span>        <span class="number">80</span>:<span class="number">31795</span>/TCP   <span class="number">6m</span>22s</span><br><span class="line">[root@k8s-<span class="keyword">master</span> <span class="title">yyhmmwan</span>]<span class="comment"># kubectl get deploy -n weave</span></span><br><span class="line">NAME                        READY   UP-TO-<span class="keyword">DATE</span>   AVAILABLE   AGE</span><br><span class="line">weave-scope-app             <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">7m</span>5s</span><br><span class="line">weave-scope-cluster-agent   <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">7m</span>5s</span><br><span class="line">[root@k8s-<span class="keyword">master</span> <span class="title">yyhmmwan</span>]<span class="comment"># kubetcl get deploy -n weave</span></span><br><span class="line">bash: kubetcl: command not found</span><br><span class="line">[root@k8s-<span class="keyword">master</span> <span class="title">yyhmmwan</span>]<span class="comment"># kubectl get deploy -n weave</span></span><br><span class="line">NAME                        READY   UP-TO-<span class="keyword">DATE</span>   AVAILABLE   AGE</span><br><span class="line">weave-scope-app             <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">8m</span>15s</span><br><span class="line">weave-scope-cluster-agent   <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">8m</span>15s</span><br></pre></td></tr></table></figure>
<h1 id="本地模式安装Kubernetes-local-clone"><a href="#本地模式安装Kubernetes-local-clone" class="headerlink" title="本地模式安装Kubernetes (local clone)"></a>本地模式安装Kubernetes (local clone)</h1><p>参考：<br><a href="https://www.weave.works/docs/scope/latest/installing/#k8s" target="_blank" rel="noopener">scope 安装</a><br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> scope</span><br><span class="line">kubectl <span class="keyword">apply</span> -f examples/k8s</span><br></pre></td></tr></table></figure></p>
<p>但这个还是从远程image拉取的模式</p>
<p>Port-forward to access weave-scope-app<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl port-forward svc/weave-scope-app -n weave 4040:80</span><br></pre></td></tr></table></figure></p>
<h1 id="本地启动scope"><a href="#本地启动scope" class="headerlink" title="本地启动scope"></a>本地启动scope</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ./scope -mode app -weave=false -debug -app.http.address 127.0.0.1:4041 </span><br><span class="line"></span><br><span class="line">sudo ./scope -mode probe -weave=false -debug -probe-only -probe.docker=true  http://127.0.0.1:4041</span><br></pre></td></tr></table></figure>
<p>在docker启动scope<br>启动容器需要挂几个目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name scope-probe -v /var/run/docker.sock:/var/run/docker.sock -v /sys/kernel/debug:/sys/kernel/debug --rm -ti --privileged=true  topsec-dsec:v1.0 /bin/bash</span><br></pre></td></tr></table></figure></p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./<span class="keyword">scope</span> -mode app -weave=<span class="literal">false</span> -<span class="keyword">debug</span> -app.http.address <span class="number">0.0</span>.0.0:<span class="number">4040</span></span><br><span class="line">./<span class="keyword">scope</span> -mode probe -weave=<span class="literal">false</span> -<span class="keyword">debug</span> -probe-only -probe.docker=<span class="literal">true</span>  http:<span class="comment">//192.168.32.68:4040</span></span><br></pre></td></tr></table></figure>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/scope-docker-k8s/">scope docker k8s</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat20.png" title="微信"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016 - 2020 Willie Lin</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>