<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Willie Lin"><link rel="alternative" href="/atom.xml" title="Willie Lin" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>k8s安装kiali - Willie Lin</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">Willie Lin</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2019-05-20T15:14:21.000Z">2019 - 05 - 20 23:14:21</time><h1 class="post__title"><a href="/2019/05/20/k8s安装kiali/">k8s安装kiali</a></h1><div class="post__main echo"><h1 id="kiali"><a href="#kiali" class="headerlink" title="kiali"></a>kiali</h1><p>kiali安装需要依赖promethus。</p>
<h2 id="安装prometheus"><a href="#安装prometheus" class="headerlink" title="安装prometheus"></a>安装prometheus</h2><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f ./myprometheus_service.yaml</span><br><span class="line">kubectl <span class="built_in">apply</span> -f ./myprometheus.yaml</span><br></pre></td></tr></table></figure>
<p>一个是配置deplement，另一个是配置service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat myprometheus_service.yaml </span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: promethues</span><br><span class="line">  name: promethues</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - port: 9090</span><br><span class="line">      targetPort: 9090</span><br><span class="line">      nodePort: 31090</span><br><span class="line">  selector:</span><br><span class="line">    app: promethues</span><br><span class="line">  type: NodePort</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat myprometheus.yaml</span><br><span class="line">kind: Deployment</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    prom-app: promethues</span><br><span class="line">  name: promethues</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: promethues</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: promethues</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: promethues</span><br><span class="line">        #image: k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1</span><br><span class="line">        image: prom/prometheus:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9090</span><br><span class="line">          protocol: TCP</span><br></pre></td></tr></table></figure>
<p>安装完后查看service<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc --all-namespaces -o wide</span><br></pre></td></tr></table></figure></p>
<p>之后通过浏览器访问，就可以看到promethus的界面</p>
<p><a href="http://127.0.0.1:31090" target="_blank" rel="noopener">http://127.0.0.1:31090</a></p>
<p>#安装kiali<br>进入kiali目录，修改deploy/kubernetes/configmap.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: kiali</span><br><span class="line">  labels:</span><br><span class="line">    app: kiali</span><br><span class="line">    version: $&#123;VERSION_LABEL&#125;</span><br><span class="line">data:</span><br><span class="line">  config.yaml: |</span><br><span class="line">    istio_namespace: $&#123;ISTIO_NAMESPACE&#125;</span><br><span class="line">    server:</span><br><span class="line">      port: 20001</span><br><span class="line">      web_root: /kiali</span><br><span class="line">    external_services:</span><br><span class="line">      jaeger:</span><br><span class="line">        url: $&#123;JAEGER_URL&#125;</span><br><span class="line">      grafana:</span><br><span class="line">        url: $&#123;GRAFANA_URL&#125;</span><br><span class="line">      prometheus_service_url: http://192.168.158.146:31090</span><br><span class="line">    #identity:</span><br><span class="line">    #  cert_file: /kiali-cert/cert-chain.pem</span><br><span class="line">    #  private_key_file: /kiali-cert/key.pem</span><br></pre></td></tr></table></figure>
<p>注意，ip地址一定要改成host的实际ip地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make k8s-deploy</span><br></pre></td></tr></table></figure>
<p>浏览器访问：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">32520</span><span class="regexp">/kiali/</span></span><br></pre></td></tr></table></figure></p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/kiali-k8s/">kiali k8s</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat20.png" title="微信"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016 - 2021 Willie Lin</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>