<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Willie Lin"><link rel="alternative" href="/atom.xml" title="Willie Lin" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>理解Kubernetes对象 - Willie Lin</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">Willie Lin</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2020-11-30T01:34:36.000Z">2020 - 11 - 30 09:34:36</time><h1 class="post__title"><a href="/2020/11/30/理解Kubernetes对象/">理解Kubernetes对象</a></h1><div class="post__main echo"><h1 id="1-kubernetes对象概述"><a href="#1-kubernetes对象概述" class="headerlink" title="1. kubernetes对象概述"></a>1. kubernetes对象概述</h1><p>kubernetes中的对象是一些持久化的实体，可以理解为是对<code>集群状态的描述或期望</code>。</p>
<p>包括：</p>
<ul>
<li>集群中哪些node上运行了哪些容器化应用</li>
<li>应用的资源是否满足使用</li>
<li>应用的执行策略，例如重启策略、更新策略、容错策略等。</li>
</ul>
<p><strong>kubernetes的对象是一种意图（期望）的记录，kubernetes会始终保持预期创建的对象存在和集群运行在预期的状态下</strong>。</p>
<p>操作kubernetes对象（增删改查）需要通过<a href="https://kubernetes.io/docs/reference/" target="_blank" rel="noopener">kubernetes API</a>，一般有以下几种方式：</p>
<ul>
<li><code>kubectl</code>命令工具</li>
<li><code>Client library</code>的方式，例如 <a href="https://github.com/kubernetes/client-go" target="_blank" rel="noopener">client-go</a></li>
</ul>
<h1 id="2-Spec-and-Status"><a href="#2-Spec-and-Status" class="headerlink" title="2. Spec and Status"></a>2. Spec and Status</h1><p>每个kubernetes对象的结构描述都包含<code>spec</code>和<code>status</code>两个部分。</p>
<ul>
<li><code>spec</code>：该内容由用户提供，描述用户期望的对象特征及集群状态。</li>
<li><code>status</code>：该内容由kubernetes集群提供和更新，描述kubernetes对象的实时状态。</li>
</ul>
<p>任何时候，kubernetes都会控制集群的实时状态<code>status</code>与用户的预期状态<code>spec</code>一致。</p>
<p>例如：当你定义<code>Deployment</code>的描述文件，指定集群中运行3个实例，那么kubernetes会始终保持集群中运行3个实例，如果任何实例挂掉，kubernetes会自动重建新的实例来保持集群中始终运行用户预期的3个实例。</p>
<h1 id="3-对象描述文件"><a href="#3-对象描述文件" class="headerlink" title="3. 对象描述文件"></a>3. 对象描述文件</h1><p>当你要创建一个kubernetes对象的时候，需要提供该对象的描述信息<code>spec</code>，来描述你的对象在kubernetes中的预期状态。</p>
<p>一般使用kubernetes API来创建kubernetes对象，其中<code>spec</code>信息可以以<code>JSON</code>的形式存放在<code>request body</code>中，也可以以<code>.yaml</code>文件的形式通过<code>kubectl</code>工具创建。</p>
<p>例如，以下为<code>Deployment</code>对象对应的<code>yaml</code>文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1beta2</span> <span class="comment"># for versions before 1.8.0 use apps/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.7.9</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>执行<code>kubectl create</code>的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#create command</span></span><br><span class="line">kubectl create -f https://k8s.io/docs/user-guide/nginx-deployment.yaml --record</span><br><span class="line"><span class="comment">#output</span></span><br><span class="line">deployment <span class="string">"nginx-deployment"</span> created</span><br></pre></td></tr></table></figure>
<h1 id="4-必须字段"><a href="#4-必须字段" class="headerlink" title="4. 必须字段"></a>4. 必须字段</h1><p>在对象描述文件<code>.yaml</code>中，必须包含以下字段。</p>
<ul>
<li>apiVersion：kubernetes API的版本</li>
<li>kind：kubernetes对象的类型</li>
<li>metadata：唯一标识该对象的元数据，包括<code>name</code>，UID，可选的<code>namespace</code></li>
<li>spec：标识对象的详细信息，不同对象的<code>spec</code>的格式不同，可以嵌套其他对象的字段。</li>
</ul>
<p>文章参考：</p>
<p><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/</a></p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/kubernetes/">kubernetes</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat20.png" title="微信"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016 - 2021 Willie Lin</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>