<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Willie Lin"><link rel="alternative" href="/atom.xml" title="Willie Lin" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Dockerfile最佳实践 - Willie Lin</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">Willie Lin</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2020-04-21T00:31:51.000Z">2020 - 04 - 21 08:31:51</time><h1 class="post__title"><a href="/2020/04/21/Dockerfile最佳实践/">Dockerfile最佳实践</a></h1><div class="post__main echo"><p>###Dockerfile入门之后面临一个问题：如何在实际的开发过程中正确配置 Dockerfile？<br>Dockerfile 有两个方向上的使用方式：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>只用 Dockerfile 管理镜像</span><br><span class="line"><span class="bullet">2. </span>使用docker-compose 容器编排技术 共同管理镜像的 build。</span><br></pre></td></tr></table></figure></p>
<h3 id="下面是我对Dockerfile最佳实践的总结："><a href="#下面是我对Dockerfile最佳实践的总结：" class="headerlink" title="下面是我对Dockerfile最佳实践的总结："></a>下面是我对Dockerfile最佳实践的总结：</h3><p>共同遵守的原则:<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">保持常见的指令像 <span class="keyword">MAINTAINER</span> 以及从上至下更新 Dockerfile 命令。</span><br><span class="line">当构建镜像时使用可理解的标签，以便更好地管理镜像。</span><br><span class="line">避免在 Dockerfile 中映射公有端口。</span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> 与 ENTRYPOINT 命令请使用数组语法。</span></span><br><span class="line">针对一：只用 Dockerfile 管理镜像的 build</span><br></pre></td></tr></table></figure></p>
<h3 id="一个简单的镜像示例"><a href="#一个简单的镜像示例" class="headerlink" title="一个简单的镜像示例"></a>一个简单的镜像示例</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 依赖最小Linux环境 alpine 只用5M大小</span></span><br><span class="line">FROM alpine</span><br><span class="line"><span class="meta"># MAINTAINER：设置该镜像的作者。</span></span><br><span class="line">MAINTAINER jinlong</span><br><span class="line"><span class="meta"># 将当前目录下的所有文件都拷贝进入 image 文件的/app目录</span></span><br><span class="line">COPY ./bin/ /app</span><br><span class="line"><span class="meta"># 指定接下来的工作路径为/app</span></span><br><span class="line"><span class="meta"># WORKDIR：指定RUN、CMD与ENTRYPOINT命令的工作目录。</span></span><br><span class="line">WORKDIR /app</span><br><span class="line"><span class="meta"># RUN：在shell或者exec的环境下执行的命令。RUN指令会在新创建的镜像上添加新的层面，接下来提交的结果用在Dockerfile的下一条指令中。</span></span><br><span class="line"><span class="meta">#RUN cd bin/</span></span><br><span class="line"><span class="meta"># ADD：复制文件指令。它有两个参数&lt;source&gt;和&lt;destination&gt;。destination是容器内的路径。source可以是URL或者是启动配置上下文中的一个文件。</span></span><br><span class="line"><span class="meta"># ADD 《src》 《destination》</span></span><br><span class="line"><span class="meta"># CMD：提供了容器默认的执行命令。 Dockerfile只允许使用一次CMD指令。 使用多个CMD会抵消之前所有的指令，只有最后一个指令生效。 CMD有三种形式：</span></span><br><span class="line"><span class="meta">#CMD ["executable","param1","param2"]</span></span><br><span class="line"><span class="meta">#CMD ["param1","param2"]</span></span><br><span class="line"><span class="meta">#CMD command param1 param2</span></span><br><span class="line"><span class="meta">#CMD ./gin</span></span><br><span class="line">CMD [<span class="string">"./gin"</span>]</span><br><span class="line"><span class="meta">#-------------</span></span><br><span class="line"><span class="meta"># 开放端口 永远都不要在这里使用端口映射，这违反了可移植性</span></span><br><span class="line"><span class="meta"># EXPOSE：指定容器在运行时监听的端口。</span></span><br><span class="line"><span class="meta"># private and public mapping</span></span><br><span class="line"><span class="meta"># EXPOSE 80:8080</span></span><br><span class="line"><span class="meta"># ENTRYPOINT：配置给容器一个可执行的命令</span></span><br><span class="line"><span class="meta"># 这意味着在每次使用镜像创建容器时一个特定的应用程序可以被设置为默认程序。同时也意味着该镜像每次被调用时仅能运行指定的应用。类似于CMD</span></span><br><span class="line"><span class="meta"># ENTRYPOINT ["executable", "param1","param2"]</span></span><br><span class="line"><span class="meta"># ENV：设置环境变量。它们使用键值对，增加运行程序的灵活性。</span></span><br><span class="line"><span class="meta"># ENV &lt;key&gt; &lt;value&gt;</span></span><br><span class="line"><span class="meta"># USER：镜像正在运行时设置一个UID。语法如下</span></span><br><span class="line"><span class="meta"># USER &lt;uid&gt;</span></span><br><span class="line"><span class="meta"># VOLUME：授权访问从容器内到主机上的目录。</span></span><br><span class="line"><span class="meta"># VOLUME ["/data"]</span></span><br></pre></td></tr></table></figure></div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/kubernetes/">kubernetes</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/Docker/">Docker</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/Centos7/">Centos7</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/image/">image</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat20.png" title="微信"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016 - 2021 Willie Lin</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>