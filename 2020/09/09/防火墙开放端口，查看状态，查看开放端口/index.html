<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Willie Lin"><link rel="alternative" href="/atom.xml" title="Willie Lin" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>防火墙开放端口，查看状态，查看开放端口 - Willie Lin</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">Willie Lin</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2020-09-09T12:25:58.000Z">2020 - 09 - 09 20:25:58</time><h1 class="post__title"><a href="/2020/09/09/防火墙开放端口，查看状态，查看开放端口/">防火墙开放端口，查看状态，查看开放端口</a></h1><div class="post__main echo"><h3 id="CentOS7-端口的开放关闭查看都是用防火墙来控制的，具体命令如下："><a href="#CentOS7-端口的开放关闭查看都是用防火墙来控制的，具体命令如下：" class="headerlink" title="CentOS7 端口的开放关闭查看都是用防火墙来控制的，具体命令如下："></a>CentOS7 端口的开放关闭查看都是用防火墙来控制的，具体命令如下：</h3><h5 id="查看防火墙状态：（active-running-即是开启状态）"><a href="#查看防火墙状态：（active-running-即是开启状态）" class="headerlink" title="查看防火墙状态：（active (running) 即是开启状态）"></a>查看防火墙状态：（active (running) 即是开启状态）</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root<span class="symbol">@WSS</span> bin]<span class="meta"># systemctl firewalld status</span></span><br><span class="line">Unknown operation <span class="string">'firewalld'</span>.</span><br></pre></td></tr></table></figure>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@WSS bin]<span class="comment"># systemctl status firewalld</span></span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded <span class="params">(/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</span></span><br><span class="line">   Active: active <span class="params">(running)</span> since 四 2019-07-11 09<span class="function">:37</span><span class="function">:11</span> CST; 7h ago</span><br><span class="line">     Docs: man<span class="function">:firewalld</span><span class="params">(1)</span></span><br><span class="line"> Main PID: 44370 <span class="params">(firewalld)</span></span><br><span class="line">    Tasks: 2</span><br><span class="line">   CGroup: <span class="string">/system.slice/firewalld.service</span></span><br><span class="line">           └─44370 <span class="string">/usr/bin/python</span> -Es <span class="string">/usr/sbin/firewalld</span> <span class="params">--nofork</span> <span class="params">--nopid</span></span><br><span class="line"></span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> FORWARD.<span class="string">..hain</span>?).</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> FORWARD.<span class="string">..hain</span>?).</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> FORWARD.<span class="string">..hain</span>?).</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> FORWARD.<span class="string">..t</span> name.</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> FORWARD.<span class="string">..t</span> name.</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> INPUT -<span class="string">...hain</span>?).</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> INPUT -<span class="string">...hain</span>?).</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> OUTPUT <span class="string">...hain</span>?).</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> INPUT -<span class="string">...hain</span>?).</span><br><span class="line">7月 11 09<span class="function">:37</span><span class="function">:13</span> WSS firewalld[44370]: WARNING: COMMAND_FAILED: '<span class="string">/usr/sbin/iptables</span> -w2 -w <span class="params">--table</span> filter <span class="params">--delete</span> INPUT -<span class="string">...hain</span>?).</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure>
<h4 id="查看已开放端口：（8080和3306-即是已开放端口）"><a href="#查看已开放端口：（8080和3306-即是已开放端口）" class="headerlink" title="查看已开放端口：（8080和3306 即是已开放端口）"></a>查看已开放端口：（8080和3306 即是已开放端口）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">[root@WSS</span> <span class="string">bin]#</span> <span class="string">firewall-cmd</span> <span class="bullet">--list-all</span></span><br><span class="line"><span class="string">public</span> <span class="string">(active)</span></span><br><span class="line"><span class="attr">  target:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  icmp-block-inversion:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">  interfaces:</span> <span class="string">ens3</span> <span class="string">ens4</span></span><br><span class="line"><span class="attr">  sources:</span> </span><br><span class="line"><span class="attr">  services:</span> <span class="string">ssh</span> <span class="string">dhcpv6-client</span></span><br><span class="line"><span class="attr">  ports:</span> <span class="number">8080</span><span class="string">/tcp</span> <span class="number">3306</span><span class="string">/tcp</span></span><br><span class="line"><span class="attr">  protocols:</span> </span><br><span class="line"><span class="attr">  masquerade:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">  forward-ports:</span> </span><br><span class="line"><span class="attr">  source-ports:</span> </span><br><span class="line"><span class="attr">  icmp-blocks:</span> </span><br><span class="line">  <span class="string">rich</span> <span class="attr">rules:</span></span><br></pre></td></tr></table></figure>
<h4 id="防火墙开放端口：（开放端口后需重载防火墙）"><a href="#防火墙开放端口：（开放端口后需重载防火墙）" class="headerlink" title="防火墙开放端口：（开放端口后需重载防火墙）"></a>防火墙开放端口：（开放端口后需重载防火墙）</h4><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@WSS bin]# firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@WSS bin]# </span><br><span class="line">[root@WSS bin]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@WSS bin]#</span><br><span class="line">命令含义：</span><br><span class="line">–zone #作用域</span><br><span class="line">–add-port=80/tcp #添加端口，格式为：端口/通讯协议</span><br><span class="line">–permanent #永久生效，没有此参数重启后失效</span><br><span class="line">firewall-cmd --reload 并不中断用户连接，即不丢失状态信息</span><br></pre></td></tr></table></figure>
<h4 id="firewalld的基本使用"><a href="#firewalld的基本使用" class="headerlink" title="firewalld的基本使用"></a>firewalld的基本使用</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">启动：<span class="keyword"> system</span>ctl start firewalld</span><br><span class="line">关闭：<span class="keyword"> system</span>ctl stop firewalld</span><br><span class="line">查看状态：<span class="keyword"> system</span>ctl status firewalld</span><br><span class="line">开机禁用 ：<span class="keyword"> system</span>ctl disable firewalld</span><br><span class="line">开机启用 ：<span class="keyword"> system</span>ctl enable firewalld</span><br></pre></td></tr></table></figure>
<h4 id="systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。"><a href="#systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。" class="headerlink" title="systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。"></a>systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。</h4><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">启动一个服务：<span class="string">systemctl </span><span class="string">start </span><span class="string">firewalld.</span><span class="string">service</span></span><br><span class="line"><span class="string">关</span>闭一个服务：<span class="string">systemctl </span><span class="string">stop </span><span class="string">firewalld.</span><span class="string">service</span></span><br><span class="line"><span class="string">重</span>启一个服务：<span class="string">systemctl </span><span class="string">restart </span><span class="string">firewalld.</span><span class="string">service</span></span><br><span class="line"><span class="string">显</span>示一个服务的状态：<span class="string">systemctl </span><span class="string">status </span><span class="string">firewalld.</span><span class="string">service</span></span><br><span class="line"><span class="string">在</span>开机时启用一个服务：<span class="string">systemctl </span><span class="string">enable </span><span class="string">firewalld.</span><span class="string">service</span></span><br><span class="line"><span class="string">在</span>开机时禁用一个服务：<span class="string">systemctl </span><span class="string">disable </span><span class="string">firewalld.</span><span class="string">service</span></span><br><span class="line"><span class="string">查</span>看服务是否开机启动：<span class="string">systemctl </span><span class="string">is-enabled </span><span class="string">firewalld.</span><span class="string">service</span></span><br><span class="line"><span class="string">查</span>看已启动的服务列表：<span class="string">systemctl </span><span class="built_in">list-unit-files|grep</span> <span class="string">enabled</span></span><br><span class="line"><span class="string">查</span>看启动失败的服务列表：<span class="string">systemctl </span><span class="built_in">--failed</span></span><br></pre></td></tr></table></figure>
<h4 id="配置firewalld-cmd"><a href="#配置firewalld-cmd" class="headerlink" title="配置firewalld-cmd"></a>配置firewalld-cmd</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查看版本： firewall-<span class="keyword">cmd</span><span class="bash"> --version</span></span><br><span class="line">查看帮助： firewall-<span class="keyword">cmd</span><span class="bash"> --<span class="built_in">help</span></span></span><br><span class="line">显示状态： firewall-<span class="keyword">cmd</span><span class="bash"> --state</span></span><br><span class="line">查看所有打开的端口： firewall-<span class="keyword">cmd</span><span class="bash"> --zone=public --list-ports</span></span><br><span class="line">更新防火墙规则： firewall-<span class="keyword">cmd</span><span class="bash"> --reload</span></span><br><span class="line">查看区域信息: firewall-<span class="keyword">cmd</span><span class="bash"> --get-active-zones</span></span><br><span class="line">查看指定接口所属区域： firewall-<span class="keyword">cmd</span><span class="bash"> --get-zone-of-interface=eth0</span></span><br><span class="line">拒绝所有包：firewall-<span class="keyword">cmd</span><span class="bash"> --panic-on</span></span><br><span class="line">取消拒绝状态： firewall-<span class="keyword">cmd</span><span class="bash"> --panic-off</span></span><br><span class="line">查看是否拒绝： firewall-<span class="keyword">cmd</span><span class="bash"> --query-panic</span></span><br></pre></td></tr></table></figure>
<h3 id="二、开放或限制端口"><a href="#二、开放或限制端口" class="headerlink" title="二、开放或限制端口"></a>二、开放或限制端口</h3><h4 id="1、开放端口"><a href="#1、开放端口" class="headerlink" title="1、开放端口"></a>1、开放端口</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如我们需要开启XShell连接时需要使用的22端口</span><br><span class="line">firewall-cmd <span class="attribute">--zone</span>=public <span class="attribute">--add-port</span>=22/tcp --permanent</span><br><span class="line">其中--permanent的作用是使设置永久生效，不加的话机器重启之后失效</span><br><span class="line">重新载入一下防火墙设置，使设置生效</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">可通过如下命令查看是否生效</span><br><span class="line">firewall-cmd <span class="attribute">--zone</span>=public <span class="attribute">--query-port</span>=22/tcp</span><br><span class="line">如下命令可查看当前系统打开的所有端口</span><br><span class="line">firewall-cmd <span class="attribute">--zone</span>=public --list-ports</span><br></pre></td></tr></table></figure>
<p><code>`</code><br>2、限制端口<br>（1）比如我们现在需要关掉刚刚打开的22端口</p>
<p>firewall-cmd –zone=public –remove-port=22/tcp –permanent</p>
<p>（2）重新载入一下防火墙设置，使设置生效</p>
<p>firewall-cmd –reload</p>
<p>（3）再去查看系统所有开放的端口，已经看到没有22端口了</p>
<p>firewall-cmd –zone=public –list-ports</p>
<p>3、批量开放或限制端口<br>（1）批量开放端口，如从100到500这之间的端口我们全部要打开</p>
<p>firewall-cmd –zone=public –add-port=100-500/tcp –permanent</p>
<p>（2）重新载入一下防火墙设置，使设置生效</p>
<p>firewall-cmd –reload</p>
<p>（3）查看系统所有开放的端口，可以看到从100到500的端口已被全部开放</p>
<p>firewall-cmd –zone=public –list-ports</p>
<p>（4）同理，批量限制端口为</p>
<p>firewall-cmd –zone=public –remove-port=100-500/tcp –permanent<br>firewall-cmd –reload<br>三、开放或限制IP<br>1、限制IP地址访问<br>（1）比如限制IP为192.168.0.200的地址禁止访问80端口即禁止访问机器</p>
<p>firewall-cmd –permanent –add-rich-rule=”rule family=”ipv4” source address=”192.168.0.200” port protocol=”tcp” port=”80” reject”</p>
<p>（2）重新载入一下防火墙设置，使设置生效</p>
<p>firewall-cmd –reload<br>（3）查看已经设置的规则</p>
<p>firewall-cmd –zone=public –list-rich-rules</p>
<p>2、解除IP地址限制<br>（1）解除刚才被限制的192.168.0.200</p>
<p>firewall-cmd –permanent –add-rich-rule=”rule family=”ipv4” source address=”192.168.0.200” port protocol=”tcp” port=”80” accept”</p>
<p>（2）重新载入一下防火墙设置，使设置生效</p>
<p>firewall-cmd –reload<br>（3）再查看规则设置发现已经没有192.168.0.200的限制了</p>
<p>firewall-cmd –zone=public –list-rich-rules</p>
<p>如设置未生效，可尝试直接编辑规则文件，删掉原来的设置规则，重新载入一下防火墙即可</p>
<p>vi /etc/firewalld/zones/public.xml</p>
<p>3、限制IP地址段<br>（1）如我们需要限制10.0.0.0-10.0.0.255这一整个段的IP，禁止他们访问</p>
<p>firewall-cmd –permanent –add-rich-rule=”rule family=”ipv4” source address=”10.0.0.0/24” port protocol=”tcp” port=”80” reject”<br>其中10.0.0.0/24表示为从10.0.0.0这个IP开始，24代表子网掩码为255.255.255.0，共包含256个地址，即从0-255共256个IP，即正好限制了这一整段的IP地址，具体的设置规则可参考下表</p>
<p>（2）重新载入一下防火墙设置，使设置生效</p>
<p>firewall-cmd –reload<br>（3）查看规则，确认是否生效</p>
<p>firewall-cmd –zone=public –list-rich-rules<br>（4）同理，打开限制为</p>
<p>firewall-cmd –permanent –add-rich-rule=”rule family=”ipv4” source address=”10.0.0.0/24” port protocol=”tcp” port=”80” accept”<br>firewall-cmd –reload</p>
</div></header></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat20.png" title="微信"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016 - 2021 Willie Lin</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>